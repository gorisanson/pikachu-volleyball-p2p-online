"use strict";(self.webpackChunkpikachu_volleyball_p2p_online=self.webpackChunkpikachu_volleyball_p2p_online||[]).push([[792],{2585:(e,t,i)=>{var r=i(4603),s=i(6787),n=i(592),a=i(3650),o=i(9449),h=i(7561),y=i(7049),l=i(3401),u=i(8077),p=i(4697),d=i(8505),m=(i(7229),i(94)),c=i(9505),I=i(1275),b=i(6546),g=i(1514),P=i(7147),w=i(5345),O=i(1674),k=i(653);class C extends m.q{constructor(e,t){super(e,t),this.physics.player1.isComputer=!1,this.physics.player2.isComputer=!1,this.keyboardArray[0].unsubscribe(),this.keyboardArray[1].unsubscribe(),this.myKeyboard=c.Uq,this.myOnlineKeyboard=new c.Nz(this.myKeyboard.inputQueue),this.peerOnlineKeyboard=new c.Nz(I.Ix.peerInputQueue),this._amIPlayer2=!1,this.keyboardArray=[this.myOnlineKeyboard,this.peerOnlineKeyboard],this._syncCounter=0,this.noInputFrameTotal.menu=1/0,this.isFirstGame=!0,this.willSaveReplay=!0}get amIPlayer2(){return this._amIPlayer2}set amIPlayer2(e){this._amIPlayer2=e,I.Ix.amIPlayer2=e,!0===this._amIPlayer2?this.keyboardArray=[this.peerOnlineKeyboard,this.myOnlineKeyboard]:this.keyboardArray=[this.myOnlineKeyboard,this.peerOnlineKeyboard]}get syncCounter(){return this._syncCounter}set syncCounter(e){this._syncCounter=(0,b.z)(e,I.fg)}intro(){0===this.frameCounter&&(this.selectedWithWho=0,this.isFirstGame?(this.isFirstGame=!1,this.amIPlayer2=!I.Ix.amICreatedRoom):I.Ix.isQuickMatch&&(0,g.Dj)()),super.intro()}menu(){const e=this.selectedWithWho;super.menu(),this.selectedWithWho!==e&&(this.amIPlayer2=!this.amIPlayer2,(0,P.sb)(I.Ix.myNickname,this.amIPlayer2),(0,P.sb)(I.Ix.peerNickname,!this.amIPlayer2),(0,P.UI)(I.Ix.myPartialPublicIP,this.amIPlayer2),(0,P.UI)(I.Ix.peerPartialPublicIP,!this.amIPlayer2),(0,k.yL)())}gameLoop(){I.Ix.gameStartAllowed&&I.Ix.isOpen&&(this.myKeyboard.getInputIfNeededAndSendToPeer(this.syncCounter),this.gameLoopFromGettingPeerInput())}gameLoopFromGettingPeerInput(){if(this.peerOnlineKeyboard.isInputOnQueue(this.syncCounter)){if(this.myOnlineKeyboard.isInputOnQueue(this.syncCounter)){if(this.peerOnlineKeyboard.getInput(this.syncCounter),this.myOnlineKeyboard.getInput(this.syncCounter),this.syncCounter++,this.willSaveReplay){const e=new O.BF;e.xDirection=this.keyboardArray[0].xDirection,e.yDirection=this.keyboardArray[0].yDirection,e.powerHit=this.keyboardArray[0].powerHit;const t=new O.BF;t.xDirection=this.keyboardArray[1].xDirection,t.yDirection=this.keyboardArray[1].yDirection,t.powerHit=this.keyboardArray[1].powerHit,w.Z.recordInputs(e,t)}if(this.slowMotionFramesLeft>0){if(this.slowMotionNumOfSkippedFrames++,this.slowMotionNumOfSkippedFrames%Math.round(this.normalFPS/this.slowMotionFPS)!=0)return;this.slowMotionFramesLeft--,this.slowMotionNumOfSkippedFrames=0}this.physics.player1.isComputer=!1,this.physics.player2.isComputer=!1,this.state(),this.peerOnlineKeyboard.inputQueue.length>c.$g&&(this.myOnlineKeyboard.inputQueue.length>c.$g?window.setTimeout(this.gameLoopFromGettingPeerInput.bind(this),0):window.setTimeout(this.gameLoop.bind(this),0))}}else I.Ix.callbackAfterPeerInputQueueReceived=this.gameLoopFromGettingPeerInput.bind(this)}}var S=i(6090),f=i(6465);const A=S.I.TEXTURES;A.WITH_COMPUTER=A.WITH_FRIEND,n.A4.registerPlugin("prepare",a.p8),n.A4.registerPlugin("batch",n.ch),u.KB.registerPlugin("prepare",d.S),u.KB.registerPlugin("sprite",p.$),h.aH.registerPlugin(y.A),r.W.RESOLUTION=2,r.W.SCALE_MODE=s.M6.NEAREST,r.W.ROUND_PIXELS=!0;const F=(0,n.q5)({width:432,height:304,antialias:!1,backgroundColor:0,backgroundAlpha:1,forceCanvas:!0}),x=new o.mc,K=new l.Rv,_=new h.aH;document.querySelector("#game-canvas-container").appendChild(F.view),F.render(x),_.add(S.I.SPRITE_SHEET);for(const e in S.I.SOUNDS)_.add(S.I.SOUNDS[e]);function D(){const e=new C(x,_.resources);(0,g.zD)(e,K),(0,k.yg)(e),function(e){K.maxFPS=e.normalFPS,K.add((()=>{F.render(x),e.gameLoop()})),K.start()}(e)}!function(){const e=document.getElementById("loading-box"),t=document.getElementById("progress-bar");_.onProgress.add((()=>{t.style.width=`${_.progress}%`})),_.onComplete.add((()=>{e.classList.add("hidden")}))}(),I.Ix.callbackAfterDataChannelOpened=()=>{_.load(D)},(0,g.aW)(),(0,f.G)()}},e=>{e.O(0,[244,415,476],(()=>e(e.s=2585))),e.O()}]);
//# sourceMappingURL=main.fd0ccfc29c4a50302bc2.js.map